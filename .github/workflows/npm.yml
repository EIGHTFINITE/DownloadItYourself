name: npm

on:
  push:
  pull_request:
  schedule:
    - cron: '0 0 * * *'

env:
  CI: true

jobs:
  npm_linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        ref: artifacts
        path: artifacts
    - uses: actions/checkout@master
      with:
        path: EIGHTFINITE-build
    - name: npm
      shell: bash
      run: |
        echo '{
          "private": "true"
        }' > package.json
        cd EIGHTFINITE-build
        ../artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/bin/node ../artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/lib/node_modules/npm/bin/npm-cli.js install --no-optional --no-bin-links --ignore-scripts
        ../artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/bin/node ../artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/lib/node_modules/npm/bin/npm-cli.js dedupe
        cd ..
        artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/bin/node artifacts/bin/linux/x64/node/node-v12.10.0-linux-x64/lib/node_modules/npm/bin/npm-cli.js install ./EIGHTFINITE-build --no-optional --no-bin-links --ignore-scripts
  npm_windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@master
      with:
        ref: artifacts
        path: artifacts
    - uses: actions/checkout@master
      with:
        path: EIGHTFINITE-build
    - name: npm
      shell: bash
      run: |
        echo '{
          "private": "true"
        }' > package.json
        cd EIGHTFINITE-build
        ../artifacts/bin/windows/x64/node/node-v12.10.0-win-x64/npm.cmd install --no-optional --no-bin-links --ignore-scripts
        ../artifacts/bin/windows/x64/node/node-v12.10.0-win-x64/npm.cmd dedupe
        cd ..
        artifacts/bin/windows/x64/node/node-v12.10.0-win-x64/npm.cmd install .\\EIGHTFINITE-build --no-optional --no-bin-links --ignore-scripts
